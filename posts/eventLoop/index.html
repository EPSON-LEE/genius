<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/genius/styles.8e6ce3531391dffbe63f.css">body,html{background-color:#fffff8;height:100%}body,html,ul{padding:0;margin:0}ul{list-style:none!important}a{background-image:none;text-shadow:none}a,a:active,a:hover,a:link,a:visited{text-decoration:none}.layout-module--layout--3sEVU{overflow:scroll}.layout-module--content--2myuE{margin-top:80px;overflow:scroll;padding:0 20px}.header-module--header--1mgxU{top:0;width:100%;height:50px;line-height:50px;position:-webkit-sticky;position:sticky;background:#000}.header-module--header_menu--1t44h{max-width:768px;margin:0 auto;text-align:center}@media (max-width:768px){.header-module--header--1mgxU{display:none}}.menu-module--header_menu_link--1jqI_{display:inline;color:#fff;padding:1rem}.menu-module--header_menu_link_activeClassName--E1ULE{background:#fff;color:#000}.mobileMenu-module--mobile_menu--N2lMO{display:inline-block;width:100%;position:fixed;top:0;z-index:999;display:none}.mobileMenu-module--mobile_menu_item_show--QiVW0{top:0;transition:all .5s ease-in}.mobileMenu-module--mobile_menu_item_hide--1-AYa,.mobileMenu-module--mobile_menu_item_show--QiVW0{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;position:relative}.mobileMenu-module--mobile_menu_item_hide--1-AYa{top:-300px;transition:all .5s ease-out}.mobileMenu-module--mobile_menu_font_item--1KegD{display:inline-block;color:#fff;background-color:#000;height:60px;line-height:60px}.mobileMenu-module--mobile_menu_font_item--1KegD:hover{font-weight:700}.mobileMenu-module--mobile_active_menu_font_item--FFLW-{font-weight:700;color:#000;background-color:#fff}@media (max-width:768px){.mobileMenu-module--mobile_menu--N2lMO{display:inline-block;width:100%;position:fixed;top:0;z-index:999}}.mobileMenu-module--fadein--26Pz4,.mobileMenu-module--fadeout--3gBQe{opacity:0;transition:opacity .4s ease-in-out}.mobileMenu-module--fadein--26Pz4{opacity:1}.ball{margin:200px;height:20px;border:1px solid;-webkit-animation:rotate 2.5s infinite,color 2s infinite,width 3s infinite;animation:rotate 2.5s infinite,color 2s infinite,width 3s infinite;-webkit-animation-direction:normal,normal,alternate;animation-direction:normal,normal,alternate}@-webkit-keyframes rotate{to{-webkit-transform:rotate(90deg);transform:rotate(90deg)}}@keyframes rotate{to{-webkit-transform:rotate(90deg);transform:rotate(90deg)}}@-webkit-keyframes color{20%{background-color:#f91}80%{background-color:#0ff}}@keyframes color{20%{background-color:#f91}80%{background-color:#0ff}}@-webkit-keyframes width{0%{width:40%}to{width:70%}}@keyframes width{0%{width:40%}to{width:70%}}.article-module--article_layout--1B_6p{height:100%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column}.article-module--article_item--VXYj6{margin-top:40px;padding:0 20px;width:90%}.article-module--article_item_body--1H0PI{width:90%}.article-module--article_item_body_title--BfT2s{margin-bottom:5px}.article-module--article_item_body_des--2C8-G{--x-height-multiplier:0.342!important;--baseline-multiplier:0.22!important;font-family:medium-content-sans-serif-font,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Geneva,Arial,sans-serif!important;letter-spacing:-.02em!important;font-weight:400!important;font-style:normal!important;letter-spacing:0!important;font-size:16px!important;line-height:20px!important;-webkit-transform:translateY(1.52px);transform:translateY(1.52px)}.contract-module--profile--2IpC-{display:block;height:80px;width:80px;background-size:80px 80px;-webkit-animation:contract-module--spin--qoT87 4s linear infinite;animation:contract-module--spin--qoT87 4s linear infinite;background-image:url(data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTIwIDEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48Y2xpcFBhdGggaWQ9ImEiPjxjaXJjbGUgY3g9IjEyNy4zMyIgY3k9Ijc4Ljk3IiByPSI1MiIvPjwvY2xpcFBhdGg+PGxpbmVhckdyYWRpZW50IGlkPSJiIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjE4OTMuMzIiIHkxPSItMjM4MS45OCIgeDI9IjE5MDEuODkiIHkyPSItMjM4MS45OCIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAtMTc4OCAtMjMyMSkiPjxzdG9wIG9mZnNldD0iLjAxIiBzdG9wLWNvbG9yPSIjNjE3NmI5Ii8+PHN0b3Agb2Zmc2V0PSIuNjkiIHN0b3AtY29sb3I9IiMzOTRhOWYiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iYyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxOTIwLjI3IiB5MT0iLTIzNzkuMzciIHgyPSIxOTI4LjA4IiB5Mj0iLTIzNzkuMzciIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgLTE3ODggLTIzMjEpIj48c3RvcCBvZmZzZXQ9Ii4wMSIgc3RvcC1jb2xvcj0iIzYxNzZiOSIvPjxzdG9wIG9mZnNldD0iLjY5IiBzdG9wLWNvbG9yPSIjMzk0YTlmIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PGNpcmNsZSBzdHJva2U9IiNERTU4MzMiIHN0cm9rZS13aWR0aD0iNSIgY3g9IjYwIiBjeT0iNjAiIHI9IjU3LjUiIGZpbGw9IiNERTU4MzMiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNjcuMzMgLTE4Ljk3KSI+PGcgY2xpcC1wYXRoPSJ1cmwoI2EpIj48cGF0aCBkPSJNMTM4LjQ2IDEzMi41M2MtMi41MS00Ljg4LTQuOTEtOS4zNy02LjQtMTIuMzQtMy45Ni03LjkzLTcuOTQtMTkuMTEtNi4xMy0yNi4zMi4zMy0xLjMxLTMuNzMtNDguNTEtNi42LTUwLjAzLTMuMTktMS43LTEwLjEyLTMuOTQtMTMuNzEtNC41NC0yLjUtLjQtMy4wNy4zLTQuMTIuNDYuOTkuMSA1LjcgMi40MiA2LjYxIDIuNTUtLjkxLjYyLTMuNi0uMDItNS4zMi43NC0uODcuNC0xLjUyIDEuODgtMS41IDIuNTggNC45LS41IDEyLjU2LS4wMSAxNy4xIDItMy42MS40MS05LjA5Ljg3LTExLjQ1IDIuMTEtNi44NCAzLjYtOS44NiAxMi4wMy04LjA2IDIyLjEzIDEuNzkgMTAuMDggOS43MiA0Ni44NSAxMi4yNSA1OS4xMyAyLjUyIDEyLjI3IDMxLjUxIDkuNyAyNy4zMiAxLjUzeiIgZmlsbD0iI0Q1RDdEOCIvPjxwYXRoIGQ9Ik0xNDIuMSAxMzMuNzJjLTMuMDEtNS45Ny02LjA4LTExLjY4LTcuODYtMTUuMjItMy45Ny03Ljk0LTcuOTMtMTkuMTEtNi4xMy0yNi4zMi4zNC0xLjMxLjM0LTYuNjcgMS40My03LjM4IDguNDEtNS41IDcuODEtLjE5IDExLjE5LTIuNjUgMS43NC0xLjI3IDMuMTMtMi44IDMuNzQtNC45IDIuMTYtNy41OC0zLTIwLjc3LTguNzgtMjYuNTQtMS44OC0xLjg4LTQuNzYtMy4wNi04LjAyLTMuNjgtMS4yNS0xLjcyLTMuMjctMy4zNi02LjEzLTQuODlhMjguODYgMjguODYgMCAwIDAtMTguMjctMi44OGMxIC4xIDMuMjYgMi4xNCA0LjE3IDIuMjctMS4zOC45NC01LjA1LjgyLTUuMDMgMi45IDQuOTItLjUgMTAuMy4yOCAxNC44NCAyLjMtMy42LjQtNi45NiAxLjMtOS4zMSAyLjU0LTYuODYgMy42LTguNjYgMTAuODEtNi44NiAyMC45MSAxLjgxIDEwLjEgOS43NCA0Ni44OCAxMi4yNiA1OS4xMyAyLjUzIDEyLjI2IDMyLjUgMTEuOCAyOC43NyA0LjQxeiIgZmlsbD0iI0ZGRiIvPjwvZz48Y2lyY2xlIHI9IjMuNzkiIGN4PSIxMTIuOCIgY3k9IjcwLjY5IiBmaWxsPSIjMkQ0RjhFIi8+PGNpcmNsZSByPSIuOTgiIGN4PSIxMTQuNDkiIGN5PSI2OS40MyIgZmlsbD0iI0ZGRiIvPjxjaXJjbGUgcj0iMy4yNSIgY3g9IjEzOC4xMiIgY3k9IjY4LjQ0IiBmaWxsPSIjMkQ0RjhFIi8+PGNpcmNsZSByPSIuODQiIGN4PSIxMzkuNTciIGN5PSI2Ny4zNiIgZmlsbD0iI0ZGRiIvPjxwYXRoIGZpbGw9InVybCgjYikiIGQ9Ik0xMTMuODkgNTkuNzJzLTIuODYtMS4zLTUuNjMuNDVjLTIuNzcgMS43NC0yLjY3IDMuNTItMi42NyAzLjUycy0xLjQ3LTMuMjggMi40NS00Ljg5YzMuOTMtMS42IDUuODUuOTIgNS44NS45MnoiLz48cGF0aCBmaWxsPSJ1cmwoI2MpIiBkPSJNMTQwLjA4IDU5LjQ2cy0yLjA1LTEuMTctMy42NS0xLjE1Yy0zLjI3LjA0LTQuMTYgMS40OC00LjE2IDEuNDhzLjU1LTMuNDQgNC43My0yLjc1YTQuMiA0LjIgMCAwIDEgMy4wOCAyLjQyeiIvPjxwYXRoIGZpbGw9IiNGREQyMEEiIGQ9Ik0xMjQuNCA4NS4zYy4zOC0yLjMgNi4zLTYuNjMgMTAuNS02LjkgNC4yLS4yNiA1LjUtLjIgOS0xLjA0IDMuNTEtLjgzIDEyLjU0LTMuMDggMTUuMDMtNC4yNCAyLjUtMS4xNSAxMy4xLjU3IDUuNjMgNC43NC0zLjIzIDEuODEtMTEuOTQgNS4xMy0xOC4xNyA2Ljk5LTYuMjIgMS44Ni05Ljk5LTEuNzgtMTIuMDYgMS4yOC0xLjY0IDIuNDMtLjMzIDUuNzYgNy4xIDYuNDUgMTAuMDQuOTMgMTkuNjYtNC41MiAyMC43Mi0xLjYyIDEuMDYgMi45LTguNjIgNi41LTE0LjUyIDYuNjItNS45LjExLTE3Ljc4LTMuOS0xOS41Ni01LjE0LTEuNzktMS4yMy00LjE2LTQuMTMtMy42Ny03LjE0eiIvPjxwYXRoIGZpbGw9IiM2NUJDNDYiIGQ9Ik0xMjguOTQgMTE1LjZzLTE0LjEtNy41My0xNC4zMy00LjQ4Yy0uMjQgMy4wNiAwIDE1LjUxIDEuNjQgMTYuNDUgMS42NS45NCAxMy40LTYuMSAxMy40LTYuMWwtLjctNS44OHptNS40LS40OHM5LjY0LTcuMjkgMTEuNzYtNi44MmMyLjExLjQ4IDIuNTggMTUuNTEuNyAxNi4yMy0xLjg4LjctMTIuOS0zLjgxLTEyLjktMy44MWwuNDUtNS42eiIvPjxwYXRoIGZpbGw9IiM0M0EyNDQiIGQ9Ik0xMjUuNTMgMTE2LjM5YzAgNC45My0uNzEgNy4wNSAxLjQgNy41MiAyLjEyLjQ3IDYuMTEgMCA3LjUzLS45NCAxLjQtLjk0LjIzLTcuMjgtLjI0LTguNDYtLjQ3LTEuMTgtOC43LS4yNC04LjcgMS44OHoiLz48cGF0aCBmaWxsPSIjNjVCQzQ2IiBkPSJNMTI2LjQzIDExNS4zYzAgNC45My0uNzEgNy4wNCAxLjQgNy41MSAyLjExLjQ4IDYuMSAwIDcuNTItLjk0IDEuNDEtLjk0LjI0LTcuMjgtLjIzLTguNDYtLjQ3LTEuMTgtOC43LS4yMy04LjcgMS44OHoiLz48L2c+PGNpcmNsZSBjeD0iNjAiIGN5PSI2MCIgcj0iNTMuMSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9IjMuODUiLz48L3N2Zz4=)}@-webkit-keyframes contract-module--spin--qoT87{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes contract-module--spin--qoT87{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.contract-module--typing--3YSqQ{width:18.5em;height:1.25em;border-right:1px solid transparent;-webkit-animation:contract-module--typing--3YSqQ 3.5s steps(37),contract-module--blink-caret--24Fjq .75s step-end infinite;animation:contract-module--typing--3YSqQ 3.5s steps(37),contract-module--blink-caret--24Fjq .75s step-end infinite;font-family:Consolas,Monaco;word-break:break-all;overflow:hidden}@-webkit-keyframes contract-module--typing--3YSqQ{0%{width:0}to{width:18.5em}}@keyframes contract-module--typing--3YSqQ{0%{width:0}to{width:18.5em}}@-webkit-keyframes contract-module--blink-caret--24Fjq{0%,to{border-color:transparent}50%{border-color:currentColor}}@keyframes contract-module--blink-caret--24Fjq{0%,to{border-color:transparent}50%{border-color:currentColor}}</style><meta name="generator" content="Gatsby 2.3.16"/><link rel="alternate" type="application/rss+xml" title="Your Site&#x27;s RSS Feed" href="/genius/rss.xml"/><link as="script" rel="preload" href="/genius/app-7fb7b5361527e85889fb.js"/><link as="script" rel="preload" href="/genius/component---src-templates-blog-post-js-c535ecd3ca3e2ae2ac83.js"/><link as="script" rel="preload" href="/genius/styles-a16ef46e119bab790baa.js"/><link as="script" rel="preload" href="/genius/webpack-runtime-a1bec25f7b7db2e2195b.js"/><link as="fetch" rel="preload" href="/genius/static/d/493/path---posts-event-loop-d-74-29b-XJhoD6u46AIaRZdGo3fEz4lx0A0.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout-module--layout--3sEVU"><div><header class="header-module--header--1mgxU"><div class="header-module--header_menu--1t44h"><a class="menu-module--header_menu_link--1jqI_" href="/genius/">Home</a><a class="menu-module--header_menu_link--1jqI_" href="/genius/about/">About</a><a class="menu-module--header_menu_link--1jqI_" href="/genius/contact/">Contact</a><a class="menu-module--header_menu_link--1jqI_" href="/genius/article/">Article</a></div></header><div class="mobileMenu-module--mobile_menu--N2lMO"><span><div style="z-index:999;color:white;font-size:40px;background:black">☰</div></span><div><div class="mobileMenu-module--mobile_menu_item_hide--1-AYa"><a class="mobileMenu-module--mobile_menu_font_item--1KegD" href="/genius/">Home</a><a class="mobileMenu-module--mobile_menu_font_item--1KegD" href="/genius/about/">About</a><a class="mobileMenu-module--mobile_menu_font_item--1KegD" href="/genius/contact/">Contact</a><a class="mobileMenu-module--mobile_menu_font_item--1KegD" href="/genius/article/">Article</a></div></div></div></div><div class="layout-module--content--2myuE"><div><h1>Event loop</h1><div><h2>Task</h2>
<p>一个event loop会有一个或多个task队列
常见的任务源有以下几种：DOM操作任务源、用户交互任务源、网络任务源（响网络活动）、history traversal任务源（eg:调用history.back()）
除了上述task来源常见的还有以下几种：</p>
<ul>
<li>script</li>
<li>setTimeout/setInterval</li>
<li>I/O</li>
<li>UI交互</li>
<li>setImmediate(under nodeJS)</li>
<li>数据库操作</li>
</ul>
<h2>Microtask</h2>
<p>一个EL中只有一个microtask队列，通常下面几种任务被认为是microtask</p>
<ul>
<li>promise（promise的then和catch才是microtask，本身其内部的代码并不是）</li>
<li>MutationObserver</li>
<li>process.nextTick(nodejs环境中)</li>
</ul>
<h2>Eventloop 循环过程</h2>
<ol>
<li>在所有task队列中选择一个最早进队列的task，用户代理可以选择任何task队列，如果没有可选的任务，则跳到6Microtasks步骤。</li>
<li>将前一步选择的task设置为 currently running task</li>
<li>Run: 运行被选择的task</li>
<li>运行结束之后，将event loop的 currently running task 置为 null</li>
<li>从task队列里移除前边Run里运行的task</li>
<li>Microtasks: 执行microtasks任务检查点。（也就是执行microtasks队列里的任务）</li>
<li>更新渲染</li>
<li>如果这是一个worker event loop，但是task队列中没有任务，并且WorkerGlobalScope对象的closing标识为true，则销毁EL，中止这些步骤，然后 run a worker</li>
<li>返回到第1步</li>
</ol></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"posts-event-loop-d74","path":"/posts/eventLoop/"};window.dataPath="493/path---posts-event-loop-d-74-29b-XJhoD6u46AIaRZdGo3fEz4lx0A0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-7fb7b5361527e85889fb.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-c535ecd3ca3e2ae2ac83.js"],"component---src-pages-about-jsx":["/component---src-pages-about-jsx-6d42a68528931a4473e1.js"],"component---src-pages-animate-jsx":["/component---src-pages-animate-jsx-faa290f91992ada1e2f3.js"],"component---src-pages-article-jsx":["/component---src-pages-article-jsx-983b9720c555754d5549.js"],"component---src-pages-contact-jsx":["/component---src-pages-contact-jsx-302ce4e08189cc7dd508.js"],"component---src-pages-hooks-jsx":["/component---src-pages-hooks-jsx-4b5decfe9fddef6b0179.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-5ee704139c0e20bd4ae9.js"],"component---src-pages-my-files-jsx":["/component---src-pages-my-files-jsx-c4ca6313b29810b4aca4.js"],"component---src-pages-toy-jsx":["/component---src-pages-toy-jsx-63f7954def1a87218ffa.js"],"pages-manifest":["/pages-manifest-55a98dd598635e1b67d2.js"]};/*]]>*/</script><script src="/genius/webpack-runtime-a1bec25f7b7db2e2195b.js" async=""></script><script src="/genius/styles-a16ef46e119bab790baa.js" async=""></script><script src="/genius/component---src-templates-blog-post-js-c535ecd3ca3e2ae2ac83.js" async=""></script><script src="/genius/app-7fb7b5361527e85889fb.js" async=""></script></body></html>